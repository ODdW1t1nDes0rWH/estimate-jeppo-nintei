<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
  <title>サービス料金プラン｜じぇっぽ</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --accent:#0066b3; --accent-2:#1aa0c8;
      --muted:#6b7280; --danger:#f39c12; --radius:12px; --container:1100px; --g:20px;
      --print-font: 'Noto Sans JP', 'Noto Sans', "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{font-family:var(--print-font);margin:0;background:var(--bg);color:#172126;line-height:1.6;-webkit-font-smoothing:antialiased}
    .wrap{max-width:var(--container);margin:36px auto;padding:28px}

    header{display:flex;align-items:center;gap:18px}
    .logo{height:84px;display:block;padding:0;margin:0}
    .logo img{height:84px;width:auto;object-fit:contain;border-radius:0;display:block}
    h1{font-size:1.5rem;margin:0;font-weight:800;letter-spacing:-0.02em}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:0.98rem}

    .hero{display:flex;justify-content:space-between;align-items:center;margin:20px 0;padding:18px;background:linear-gradient(180deg,#fff,#fbfdff);border-radius:12px;box-shadow:0 6px 18px rgba(10,30,60,0.06);border:1px solid rgba(10,20,40,0.03)}
    .hero .summary{max-width:66%}
    .cta{display:flex;gap:12px;align-items:center}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;text-decoration:none;transition:transform .12s ease,box-shadow .12s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,100,160,0.12)}
    .btn.secondary{background:#fff;color:var(--accent);border:2px solid rgba(0,102,179,0.12)}

    section{margin-top:28px}
    .section-title{display:flex;align-items:center;gap:12px;margin-bottom:12px;justify-content:space-between}
    .section-title h2{margin:0;font-size:1.12rem;position:relative;padding-left:12px;scroll-margin-top:80px}
    .section-title h2::before{content:"";position:absolute;left:0;top:50%;transform:translateY(-50%);width:6px;height:28px;background:linear-gradient(180deg,var(--accent),var(--accent-2));border-radius:4px}
    .section-controls{display:flex;align-items:center;gap:10px}

    .grid{display:grid;gap:var(--g)}
    .pricing-groups{grid-template-columns:repeat(2,1fr)}
    .group{background:var(--card);padding:20px;border-radius:12px;border:1px solid rgba(10,20,40,0.04);box-shadow:0 4px 10px rgba(12,20,30,0.02);margin-bottom:12px}
    .group h3{margin:0 0 12px;font-size:0.95rem;color:var(--accent);font-weight:700;padding-bottom:8px;border-bottom:2px solid rgba(0,102,179,0.08);letter-spacing:0.02em}
    .item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-top:1px dashed rgba(15,25,30,0.04);gap:12px}
    .item:first-of-type{border-top:0;padding-top:0}
    .item .meta{flex:1;margin-right:10px}
    .item .name{color:#111;font-size:0.98rem;font-weight:600}
    .item .desc{color:var(--muted);font-size:0.92rem;margin-top:6px}

    .price{font-weight:900;color:var(--accent);font-size:1.05rem}
    .price small{font-weight:500;color:var(--muted);display:block;font-size:0.78rem}
    .badge{display:inline-block;background:var(--danger);color:#fff;padding:6px 10px;border-radius:999px;font-weight:700;font-size:0.85rem}

    .feature-cards{grid-template-columns:repeat(3,1fr)}
    .feature{background:linear-gradient(180deg,#fff,#f7fcff);padding:18px;border-radius:12px;border:1px solid rgba(0,0,0,0.03)}
    .feature h4{margin:0 0 8px}
    .feature p{margin:0;color:var(--muted)}
    .note{font-size:0.95rem;color:var(--muted);margin-top:12px}
    footer{margin-top:34px;padding:20px 14px;background:transparent;text-align:center;color:var(--muted);font-size:0.95rem}

    /* Responsive */
    @media (max-width:900px){
      .hero{flex-direction:column;align-items:flex-start}
      .hero .summary{max-width:100%}
      .pricing-groups{grid-template-columns:1fr}
      .feature-cards{grid-template-columns:1fr}
      .logo{height:64px}
      .logo img{height:64px}
      /* モバイルでは説明を価格の下に並べる */
      .item{flex-direction:column;align-items:flex-start}
      .item .meta{margin-right:0}
    }

    /* Print */
    @media print{
      @page{size:A4;margin:12mm}
      body{background:#fff}
      .hero,.group,.feature{box-shadow:none;border:1px solid #eee}
      .btn,.badge{display:none}
      .wrap{margin:0}
      header{page-break-inside:avoid}
    }

    /* テーブル表示 */
    .table {width:100%;border-collapse:collapse;margin-top:12px}
    .table td{padding:8px 10px;border-top:1px solid #f1f3f5}
    /* 価格桁揃え */
    .price{white-space:nowrap}
    /* 目次と見積りのスタイル */
    .toc{background:#fff;padding:12px;border-radius:10px;border:1px solid rgba(10,20,30,0.04);box-shadow:0 4px 10px rgba(12,20,30,0.02);margin-top:10px}
    .toc ul{margin:8px 0 0;padding:0;list-style:none}
    .toc li{margin:6px 0}
    .toc a{color:var(--accent);text-decoration:none}
    .estimator{background:linear-gradient(180deg,#f8fcff,#fff);padding:14px;border-radius:10px;border-left:4px solid var(--accent);margin-top:12px}
    .estimator h3{margin:0 0 8px}
    .item-checkbox{margin-right:10px;display:inline-flex;align-items:center;padding:6px 8px;border-radius:6px;cursor:pointer}
    .item-checkbox input[type="checkbox"]{width:18px;height:18px;margin:0}
    .skiplink{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <div id="main" class="wrap" role="main">
    <a class="skiplink" href="#main">Skip to content</a>
    <header>
      <div class="logo"><img src="https://jepo.jp/wp-content/uploads/2024/08/logo-1024x192.webp" srcset="https://jepo.jp/wp-content/uploads/2024/08/logo-1024x192.webp 1x, https://jepo.jp/wp-content/uploads/2024/08/logo-1024x192.webp 2x" alt="じぇっぽロゴ"></div>
      <div>
        <h1>じぇっぽ — サービス料金一覧</h1>
        <p class="lead">日本語学校の設立・運営支援に特化したサービスメニュー（税別）。</p>
      </div>
    </header>

    <div class="hero" role="region" aria-label="概要と操作">
      <div class="summary">
        <p class="note">価格はすべて税別。内容・回数によって金額は変動します。詳細は個別見積もり。</p>
      </div>
      <div class="cta">
        <a class="btn" href="#contact">お問い合わせ</a>
        <a class="btn secondary" href="#" onclick="window.print();return false;" aria-label="PDFとして保存">PDFダウンロード</a>
        <button class="btn" id="exportCsv" type="button">CSV出力</button>
        <button class="btn" id="exportJson" type="button">JSON出力</button>
      </div>
    </div>

    <!-- 目次 -->
    <nav class="toc" aria-label="目次">
      <strong>目次</strong>
      <ul>
        <li><a href="#guide">使い方</a></li>
        <li><a href="#info">情報提供</a></li>
        <li><a href="#diagnosis">診断</a></li>
        <li><a href="#design">基盤設計</a></li>
        <li><a href="#docs">書類確認</a></li>
        <li><a href="#review">審査対策</a></li>
        <li><a href="#management">プロジェクト管理</a></li>
      </ul>
    </nav>

    <!-- 見積フォーム / エスティメーター -->
    <aside class="estimator" aria-label="見積もりツール">
      <h3>見積りシミュレーター</h3>
      <p class="note">操作方法：下記ボタンでそれぞれ計算します。</p>
      <div style="margin-top:8px">
        <label>オンライン相談時間（時間）: <input type="number" id="onlineHours" min="0" value="1" style="width:72px"></label>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="calcBtn" type="button">合計を計算</button>
        <button class="btn" id="calcWithOnline" type="button">オンライン相談を含めた合計を計算する</button>
        <button class="btn secondary" id="uncheckAll" type="button">すべてのチェックを外す</button>
        <button class="btn secondary" id="checkAll" type="button">すべて選択</button>
      </div>
      <div class="estimate-result" id="estimateResult" style="margin-top:10px;font-weight:800" aria-live="polite">合計: —</div>
      <div style="margin-top:8px"><button class="btn secondary" id="calcAll" type="button">全サービスを申し込む</button></div>
    </aside>

    <!-- 使い方ガイド（Estimator直後に配置） -->
    <section id="guide" aria-label="使い方ガイド">
      <div class="section-title"><h2>使い方ガイド</h2></div>
      <div class="feature" style="padding:16px">
        <ol style="margin:0 0 10px 1.2em">
          <li style="margin:6px 0">
            <strong>1. サービスを選ぶ</strong>
            <p>各項目のチェックを入れると、自動的に合計に反映されます。</p>
            <p>セクションごとにまとめて選びたい場合は、見出し横の「このセクションをすべて選択」をクリック。</p>
            <p>画面下の「すべて選択／すべてのチェックを外す」ボタンで一括操作も可能です。</p>
          </li>
          <li style="margin:6px 0">
            <strong>2. オンライン相談を設定する</strong>
            <p>「オンライン相談時間（時間）」に希望する時間数を入力してください（0以上の整数）。</p>
            <p>オンライン相談のチェックがONになっている場合のみ、料金に含まれます。</p>
          </li>
          <li style="margin:6px 0">
            <strong>3. 合計を確認する（3つの方法）</strong>
            <p>通常の合計を計算 … 選択したサービスの合計金額を表示します（オンライン相談は含みません）。</p>
            <p>オンライン相談を含めた合計 … 選択したサービスの合計 ＋ （相談時間 × 15,000円/時）。</p>
            <p>全サービスを申し込む … 主要なサービスをまとめて計算し、セット割引が自動で適用されます。※一部のサービス（プロジェクト管理など）はチェックしたものだけ反映されます。</p>
          </li>
          <li style="margin:6px 0">
            <strong>4. 出力・保存する</strong>
            <p>CSV出力／JSON出力 … 現在の選択内容をファイルとして保存できます。</p>
            <p>PDFダウンロード … 印刷や社内共有に便利です（税別表示）。</p>
          </li>
          <li style="margin:6px 0">
            <strong>5. よくある質問（FAQ）</strong>
            <p>割引はどうやって反映されますか？ → 条件を満たすと自動で割引が適用されます。</p>
            <p>オンライン相談を入れない場合は？ → 時間を0に設定するか、チェックを外してください。</p>
            <p>保存方法は？ → CSV／JSON／PDFのいずれかで保存できます。</p>
          </li>
        </ol>
      </div>
    </section>

    <!-- 情報提供 -->
    <section id="info">
      <div class="section-title">
        <h2>★ 情報提供</h2>
        <div class="section-controls"></div>
      </div>
      <div class="grid">
        <div class="pricing-groups">
          <div class="group">
            <h3>情報提供（サンプル・説明会）</h3>
            <div class="item"><div class="meta"><div class="name">サンプルの提供</div><div class="desc">認定申請書類のご参考となる記入サンプルをご提供いたします。</div></div><div class="price">0円<small>（サービス）</small></div></div>
            <div class="item"><div class="meta"><div class="name">動画①（説明会）</div><div class="desc">説明会動画その1（概要編）</div></div><div class="price">15,000円</div></div>
            <div class="item"><div class="meta"><div class="name">動画②（説明会）</div><div class="desc">説明会動画その2（審査編）</div></div><div class="price">15,000円</div></div>
            <div class="item"><div class="meta"><div class="name">動画③（説明会）</div><div class="desc">説明会動画その3（書類編）</div></div><div class="price">15,000円</div></div>
            <div class="item"><div class="meta"><div class="name">動画④（説明会）</div><div class="desc">説明会動画その4（カリキュラム編）</div></div><div class="price">15,000円</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 診断 -->
    <section id="diagnosis">
      <div class="section-title">
        <h2>★ 診断</h2>
        <div class="section-controls"></div>
      </div>
      <div class="grid">
        <div class="pricing-groups">
          <div class="group">
            <h3>適正レビュー</h3>
            <div class="item"><div class="meta"><div class="name">設置代表者</div><div class="desc">現在の組織体制や役割分担の適正をチェックします。</div></div><div class="price">10,000円</div></div>
            <div class="item"><div class="meta"><div class="name">校長</div><div class="desc">現在の校長について認定申請に必要な知識や経験の確認を行います。</div></div><div class="price">10,000円</div></div>
            <div class="item"><div class="meta"><div class="name">主任教員</div><div class="desc">現在の主任教員の教育経験やカリキュラム編成能力の確認・評価を行います。</div></div><div class="price">10,000円</div></div>
          </div>
          <div class="group">
            <h3>教育課程の適正レビュー</h3>
            <div class="item"><div class="meta"><div class="name">教育課程レビュー</div><div class="desc">現行のカリキュラムの整合性や学習目標の妥当性をレビューします。</div></div><div class="price">30,000円</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 基盤設計 -->
    <section id="design">
      <div class="section-title">
        <h2>★ 基盤設計</h2>
        <div class="section-controls"></div>
      </div>
      <div class="grid">
        <div class="pricing-groups">
          <div class="group">
            <h3>ロードマップ・改善</h3>
            <div class="item"><div class="meta"><div class="name">認定申請戦略設計</div><div class="desc">理念・目標・学校の特徴・教育課程・課程の目標など、根幹となる部分の検討をサポートします。</div></div><div class="price">80,000円</div></div>
            <div class="item"><div class="meta"><div class="name">改善報告書作成支援</div><div class="desc">過去申請がある場合、原因・改善方法・今後の戦略などを助言します。</div></div><div class="price">90,000円</div></div>
          </div>
          <div class="group">
            <h3>主任研修</h3>
            <div class="item"><div class="meta"><div class="name">研修A（主任研修）</div><div class="desc">認定制度理解・参照枠の理解を中心としたプログラムです。</div></div><div class="price">36,000円</div></div>
            <div class="item"><div class="meta"><div class="name">研修B（主任研修）</div><div class="desc">実践を中心として、一部カリキュラムの作成をワークショップ形式で行う研修プログラムです。</div></div><div class="price">114,000円</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 書類確認 -->
    <section id="docs">
      <div class="section-title">
        <h2>★ 書類確認</h2>
        <div class="section-controls"></div>
      </div>
      <div class="grid">
        <div class="pricing-groups">
          <div class="group">
            <h3>チェック項目</h3>
            <div class="item"><div class="meta"><div class="name">事前相談指摘事項確認・修正内容FB</div><div class="desc">事前相談で挙がった指摘事項の確認と修正内容のフィードバック。</div></div><div class="price">20,000円</div></div>
            <div class="item"><div class="meta"><div class="name">申請要件チェック</div><div class="desc">申請に必要な人員・施設・財務要件を満たしているか確認します。</div></div><div class="price">10,000円</div></div>
            <div class="item"><div class="meta"><div class="name">書類整合チェック</div><div class="desc">各書類が手引きに沿って記載されているか・書類間の不整合がないか確認します。</div></div><div class="price">90,000円</div></div>
            <div class="item"><div class="meta"><div class="name">カリキュラムチェック</div><div class="desc">教育課程が「課程編成の指針」「参照枠」に沿っているか、また一貫性・運営上の妥当性があるか確認します。</div></div><div class="price">150,000円</div></div>
            <div class="item"><div class="meta"><div class="name">総合チェック</div><div class="desc">書類全体について、理念とカリキュラムの整合性や運営における不整合などがないか確認します。</div></div><div class="price">50,000円</div></div>
            <div class="item"><div class="meta"><div class="name">書類読み合わせ</div><div class="desc">記載書類を理解するためのポイントをお伝えしながら読み合わせを行います。</div></div><div class="price">60,000円</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 審査対策 -->
    <section id="review">
      <div class="section-title">
        <h2>★ 審査対策</h2>
        <div class="section-controls"></div>
      </div>
      <div class="grid">
        <div class="pricing-groups">
          <div class="group">
            <h3>資料・面接対策</h3>
            <div class="item"><div class="meta"><div class="name">審査対策基礎</div><div class="desc">学則や運営設備など学校の基本的な情報に基づいた審査対策を行います。</div></div><div class="price">60,000円</div></div>
            <div class="item"><div class="meta"><div class="name">代表者基礎</div><div class="desc">代表者向けに想定される質問事項について回答の整理を行います。</div></div><div class="price">60,000円</div></div>
            <div class="item"><div class="meta"><div class="name">代表者発展</div><div class="desc">代表者が回答すべき箇所について根拠となる書類や基準条文の理解を深めます。</div></div><div class="price">20,000円</div></div>
            <div class="item"><div class="meta"><div class="name">校長基礎</div><div class="desc">校長向けに想定される質問事項について回答の整理を行います。</div></div><div class="price">60,000円</div></div>
            <div class="item"><div class="meta"><div class="name">校長発展</div><div class="desc">校長向が回答すべき箇所について根拠となる書類や基準条文の理解を深めます。</div></div><div class="price">20,000円</div></div>
            <div class="item"><div class="meta"><div class="name">主任基礎</div><div class="desc">主任向けに想定される質問事項について回答の整理を行います。</div></div><div class="price">60,000円</div></div>
            <div class="item"><div class="meta"><div class="name">主任発展</div><div class="desc">主任向が回答すべき箇所について根拠となる書類や基準条文の理解を深めます。</div></div><div class="price">20,000円</div></div>
            <div class="item"><div class="meta"><div class="name">主任実践</div><div class="desc">主任の回答について、回答の簡潔さなどこれまでの内容を踏まえた最終調整を行います。</div></div><div class="price">20,000円</div></div>
          </div>
        </div>

        <div class="pricing-groups" style="margin-top:14px;">
          <div class="group">
            <h3>回答案・ロールプレイ</h3>
            <div class="item"><div class="meta"><div class="name">面接ロールプレイ（第1回）</div><div class="desc">第1回目のロールプレイ。実際の面接審査に沿って、質問を行っていきます。</div></div><div class="price">70,000円</div></div>
            <div class="item"><div class="meta"><div class="name">面接ロールプレイ（第2回）</div><div class="desc">第2回目のロールプレイ。</div></div><div class="price">40,000円</div></div>
            <div class="item"><div class="meta"><div class="name">面接ロールプレイ（第3回）</div><div class="desc">第3回目のロールプレイ。</div></div><div class="price">40,000円</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- プロジェクト管理 -->
    <section id="management">
      <div class="section-title">
        <h2>★ プロジェクト管理・担当者支援</h2>
        <div class="section-controls"></div>
      </div>
      <div class="grid">
        <div class="pricing-groups">
          <div class="group">
            <h3>伴走支援</h3>
            <div class="item"><div class="meta"><div class="name">認定申請マネージャーの伴走支援</div><div class="desc">申請の準備期間から申請結果の通知までの期間、認定申請経験のあるマネージャーが専任で伴走します。</div></div><div class="price">500,000円<span class="badge" style="margin-left:8px;">推奨</span></div></div>
            <div class="item"><div class="meta"><div class="name">オンライン相談（1時間）</div><div class="desc">オンラインでの相談（1時間あたり）。</div></div><div class="price">15,000円</div></div>
          </div>
        </div>
      </div>
    </section>

    <section id="contact">
      <div class="section-title"><h2>お問い合わせ</h2></div>
      <p>ご相談・見積もりは下記までご連絡ください。</p>
      <p><strong>メール：</strong><a href="mailto:info@example.com">info@example.com</a>　　<strong>電話：</strong>03-1234-5678</p>
    </section>

    <footer>
      © 2025 じぇっぽ
    </footer>
  </div>
  <script>
    // --- Helper: iterate sections
    function eachSection(cb){
      document.querySelectorAll('section').forEach(sec=>{
        const st = sec.querySelector('.section-title');
        if(st) cb(sec, st);
      });
    }

    // Insert visible checkboxes into each item on load (unchecked by default)
    // Also detect and store any "full-support" or "8実施時" alternate prices on the item element as data-full
    document.addEventListener('DOMContentLoaded', ()=>{
      document.querySelectorAll('.item').forEach(it=>{
        // add checkbox if missing
        if(!it.querySelector('input[type="checkbox"]')){
          const cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.className = 'item-check';
          // default checked for all except meetings and manager; online consult defaults to checked per request
          const nameEl = it.querySelector('.name');
          const nameText = nameEl ? nameEl.textContent.trim() : '';
          const isMeeting = /打ち合わせ/.test(nameText);
          const isManager = /伴走支援|認定申請マネージャー/.test(nameText);
          const isOnline = /オンライン相談/.test(nameText);
          if(isOnline) cb.checked = true; else cb.checked = !(isMeeting || isManager);
          // wrap in a label to enlarge click area
          const wrapper = document.createElement('label');
          wrapper.className = 'item-checkbox';
          wrapper.appendChild(cb);
          const spanText = document.createElement('span');
          spanText.style.width = '8px';
          spanText.style.display = 'inline-block';
          wrapper.appendChild(spanText);
          const meta = it.querySelector('.meta');
          if(meta) meta.prepend(wrapper); else it.prepend(wrapper);
        }

        // parse description for conditional / full-support price hints and store as data-conditional and/or data-full
        try{
          const desc = it.querySelector('.desc')?.textContent || '';
          let m = null;
          m = desc.match(/(?:[0-9]+)\s*を実施している場合[^0-9]*([0-9,，]+)円/);
          if(!m) m = desc.match(/8.?実施.*?([0-9,，]+)円/);
          if(m){
            const num = Number(m[1].replace(/,|，/g,''));
            if(!Number.isNaN(num) && num>0) it.dataset.conditional = String(num);
          }
          m = desc.match(/フルサポート[^0-9]*([0-9,，]+)円/);
          if(!m) m = desc.match(/一括額[:：]?\s*([0-9,，]+)円/);
          if(m){
            const num2 = Number(m[1].replace(/,|，/g,''));
            if(!Number.isNaN(num2) && num2>0) it.dataset.full = String(num2);
          }
        }catch(e){}

        // set B-price mapping
        try{
          const name = it.querySelector('.name')?.textContent?.trim()||'';
          const mapB = {
            '動画①（説明会）':15000,'動画②（説明会）':15000,'動画③（説明会）':15000,'動画④（説明会）':15000,
            '設置代表者':10000,'校長':10000,'主任教員':10000,'教育課程レビュー':30000,
            '研修A（主任研修）':36000,'研修B（主任研修）':114000,
            '改善報告書作成支援':90000,'認定申請戦略設計':80000,
            '事前相談指摘事項確認・修正内容FB':20000,
            '確認①':10000,'確認②':90000,'確認③':150000,'確認④':50000,
            '書類読み合わせ':30000,'審査対策基礎':30000,
            '代表者基礎':20000,'代表者発展':20000,'校長基礎':20000,'校長発展':20000,'主任基礎':20000,'主任発展':20000,'主任実践':20000,
            '面接ロールプレイ（第1回）':40000,'面接ロールプレイ（第2回）':40000,'面接ロールプレイ（第3回）':40000
          };
          if(mapB[name]!==undefined) it.dataset.b = String(mapB[name]);
        }catch(e){}
      });

      // Build per-section master checkbox controls
      eachSection((sec, title)=>{
        const controls = title.querySelector('.section-controls');
        if(controls && !controls.querySelector('.section-master')){
          const label = document.createElement('label');
          label.className = 'item-checkbox';
          const master = document.createElement('input');
          master.type = 'checkbox';
          master.className = 'section-master';
          master.setAttribute('aria-label','このセクションをすべて選択');
          const text = document.createElement('span');
          text.textContent = 'このセクションをすべて選択';
          label.appendChild(master);
          label.appendChild(text);
          controls.appendChild(label);
        }
      });

      // Initialize masters based on current item states
      updateAllSectionMasters();
    });

    // collect items
    function collectItems(){
      const items = Array.from(document.querySelectorAll('.item'));
      return items.map(it=>{
        const name = it.querySelector('.name')?.textContent?.trim()||'';
        const desc = it.querySelector('.desc')?.textContent?.trim()||'';
        const priceText = it.querySelector('.price')?.textContent?.trim()||'0円';
        const price = Number((priceText.replace(/[^0-9]/g,''))||0);
        const checkbox = it.querySelector('input[type="checkbox"]');
        const checked = checkbox ? checkbox.checked : true;
        const conditional = it.dataset && it.dataset.conditional ? Number(it.dataset.conditional) : null;
        const full = it.dataset && it.dataset.full ? Number(it.dataset.full) : null;
        const bprice = it.dataset && it.dataset.b ? Number(it.dataset.b) : null;
        const isOnline = /オンライン相談/.test(name);
        const sectionEl = it.closest('section');
        const sectionTitle = sectionEl ? (sectionEl.querySelector('.section-title h2')?.textContent || '') : '';
        const isProject = /プロジェクト管理/.test(sectionTitle);
        return {name,desc,price,conditional,full,bprice,checked,isOnline,isProject,el:it};
      });
    }

    function download(filename, content){
      const a = document.createElement('a');
      const blob = new Blob([content],{type:'text/plain;charset=utf-8'});
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    document.getElementById('exportCsv').addEventListener('click',()=>{
      const rows = collectItems();
      const lines = ['"name","description","price","checked"',...rows.map(r=>`"${r.name.replace(/\"/g,'""')}","${r.desc.replace(/\"/g,'""')}",${r.price},${r.checked?1:0}`)];
      download('prices.csv',lines.join('\n'));
    });

    document.getElementById('exportJson').addEventListener('click',()=>{
      const rows = collectItems();
      download('prices.json',JSON.stringify(rows,null,2));
    });

    // estimator: simply sum checked item prices (A価格、オンライン相談除外)
    function calcTotal(){
      const items = collectItems();
      const total = items.filter(i=>i.checked && !i.isOnline).reduce((s,i)=>s + (i.price||0),0);
      return total;
    }

    document.getElementById('calcBtn').addEventListener('click',()=>{
      const total = calcTotal();
      document.getElementById('estimateResult').textContent = '合計: ' + total.toLocaleString() + '円（税別）';
    });

    document.getElementById('calcWithOnline').addEventListener('click',()=>{
      const items = collectItems();
      const onlineHours = Number(document.getElementById('onlineHours')?.value || 0);
      let total = 0;
      items.forEach(i=>{
        if(i.checked){
          if(i.isOnline){
            total += (15000 * onlineHours);
          } else {
            total += (i.price||0);
          }
        }
      });
      document.getElementById('estimateResult').textContent = '合計: ' + total.toLocaleString() + '円（税別）';
    });

    document.getElementById('calcAll').addEventListener('click',()=>{
      // B価格優先（なければ conditional → full → 表示価格）
      const items = collectItems();
      const onlineHours = Number(document.getElementById('onlineHours')?.value || 0);
      let total = 0;
      items.forEach(i=>{
        // プロジェクト管理セクションはチェック済みのみ対象
        if(i.isProject && !i.checked) return;

        if(i.isOnline){
          if(i.bprice) total += i.bprice * onlineHours;
          else if(i.conditional) total += i.conditional * onlineHours;
          else if(i.full) total += i.full * onlineHours;
          else total += 15000 * onlineHours;
          return;
        }
        if(i.bprice) total += i.bprice;
        else if(i.conditional) total += i.conditional;
        else if(i.full) total += i.full;
        else total += (i.price||0);
      });
      document.getElementById('estimateResult').textContent = '全サービス合計 : ' + total.toLocaleString() + '円（税別）';
    });

    // --- Section master checkbox behavior
    function updateSectionMaster(sectionEl){
      const master = sectionEl.querySelector('.section-master');
      if(!master) return;
      const items = sectionEl.querySelectorAll('.item input[type="checkbox"]');
      const total = items.length;
      const checked = Array.from(items).filter(cb=>cb.checked).length;
      if(checked === 0){
        master.checked = false;
        master.indeterminate = false;
      }else if(checked === total){
        master.checked = true;
        master.indeterminate = false;
      }else{
        master.checked = false;
        master.indeterminate = true;
      }
    }

    function updateAllSectionMasters(){
      eachSection((sec)=>updateSectionMaster(sec));
    }

    // すべてのアイテムチェック状態をまとめて変更
    function setAllItemsChecked(checked){
      document.querySelectorAll('.item input[type="checkbox"]').forEach(cb=>{ cb.checked = checked; });
      updateAllSectionMasters();
    }

    // グローバル一括ON/OFF（typeはHTML側でも指定）
    const btnCheckAll = document.getElementById('checkAll');
    const btnUncheckAll = document.getElementById('uncheckAll');
    if(btnCheckAll){ btnCheckAll.addEventListener('click', ()=> setAllItemsChecked(true)); }
    if(btnUncheckAll){
      btnUncheckAll.addEventListener('click', ()=>{
        setAllItemsChecked(false);
        document.querySelectorAll('.section-title input.section-master[type="checkbox"]').forEach(cb=>{
          cb.checked=false; cb.indeterminate=false;
        });
      });
    }

    // イベント委譲：セクションマスター/アイテムの相互同期
    document.addEventListener('change',(e)=>{
      // Master toggles items in section
      if(e.target && e.target.matches('.section-master')){
        const section = e.target.closest('section');
        const checked = e.target.checked;
        section.querySelectorAll('.item input[type="checkbox"]').forEach(cb=>{ cb.checked = checked; });
        e.target.indeterminate = false;
      }
      // Item checkbox updates its section master
      if(e.target && e.target.matches('.item input[type="checkbox"]')){
        const section = e.target.closest('section');
        if(section) updateSectionMaster(section);
      }
    });
  </script>
</body>
</html>
